<!-- Header -->
<ion-header class="bg-white shadow-sm">
  <div class="flex items-center justify-between px-4 py-3">
    <div class="flex items-center gap-3">
      <ion-icon name="arrow-back" class="text-2xl text-gray-700 cursor-pointer" (click)="goBack()"></ion-icon>
      <div>
        <h1 class="text-lg font-bold text-gray-800">Pengaturan</h1>
        <p class="text-gray-500 text-sm">Kelola akun dan preferensi aplikasi</p>
      </div>
    </div>
  </div>
</ion-header>

<ion-content class="bg-gray-50">
  <div class="bg-surface-sunken pb-10 min-h-screen overflow-y-auto">
    <div class="p-4 space-y-6">

      <!-- Profile Header -->
      <div class="profile-header rounded-xl shadow-lg p-6 text-white fade-in">
        <div class="flex items-center gap-4">
          <div class="relative">
            <div class="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center">
              <ion-icon name="person" class="text-3xl"></ion-icon>
            </div>
            <div *ngIf="userProfile.isVerified" 
                 class="absolute -top-1 -right-1 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
              <ion-icon name="checkmark" class="text-white text-sm"></ion-icon>
            </div>
          </div>
          <div class="flex-1">
            <h2 class="text-xl font-bold">{{ userProfile.name }}</h2>
            <p class="text-white/80 text-sm">{{ userProfile.email }}</p>
            <div class="flex items-center gap-4 mt-2">
              <div class="flex items-center gap-1">
                <ion-icon name="star" class="text-yellow-300"></ion-icon>
                <span class="text-sm">{{ userProfile.rating }}/5</span>
              </div>
              <div class="text-sm">{{ userProfile.totalOrders }} order selesai</div>
              <div class="text-sm">Bergabung {{ formatJoinDate() }}</div>
            </div>
          </div>
        </div>
      </div>
  
      <!-- Navigation Menu -->
      <div class="grid grid-cols-3 gap-3 fade-in">
        <button (click)="setCurrentSection('profile')" 
                class="p-4 rounded-xl text-center transition-colors"
                [class]="currentSection === 'profile' ? 'bg-blue-600 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'">
          <ion-icon name="person" class="text-2xl mb-2"></ion-icon>
          <p class="text-xs font-medium">Profil</p>
        </button>
        
        <button (click)="setCurrentSection('notifications')" 
                class="p-4 rounded-xl text-center transition-colors"
                [class]="currentSection === 'notifications' ? 'bg-blue-600 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'">
          <ion-icon name="notifications" class="text-2xl mb-2"></ion-icon>
          <p class="text-xs font-medium">Notifikasi</p>
        </button>
        
        <button (click)="setCurrentSection('security')" 
                class="p-4 rounded-xl text-center transition-colors"
                [class]="currentSection === 'security' ? 'bg-blue-600 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'">
          <ion-icon name="shield" class="text-2xl mb-2"></ion-icon>
          <p class="text-xs font-medium">Keamanan</p>
        </button>
        
        <button (click)="setCurrentSection('preferences')" 
                class="p-4 rounded-xl text-center transition-colors"
                [class]="currentSection === 'preferences' ? 'bg-blue-600 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'">
          <ion-icon name="settings" class="text-2xl mb-2"></ion-icon>
          <p class="text-xs font-medium">Preferensi</p>
        </button>
        
        <button (click)="setCurrentSection('business')" 
                class="p-4 rounded-xl text-center transition-colors"
                [class]="currentSection === 'business' ? 'bg-blue-600 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'">
          <ion-icon name="business" class="text-2xl mb-2"></ion-icon>
          <p class="text-xs font-medium">Bisnis</p>
        </button>
        
        <button (click)="setCurrentSection('help')" 
                class="p-4 rounded-xl text-center transition-colors"
                [class]="currentSection === 'help' ? 'bg-blue-600 text-white' : 'bg-white text-gray-600 hover:bg-gray-50'">
          <ion-icon name="help" class="text-2xl mb-2"></ion-icon>
          <p class="text-xs font-medium">Bantuan</p>
        </button>
      </div>
  
      <!-- Profile Section -->
      <div *ngIf="currentSection === 'profile'" class="space-y-4 fade-in">
        
        <!-- Personal Info -->
        <div class="setting-card p-4">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-bold text-gray-800">Informasi Pribadi</h3>
            <button (click)="isEditingProfile ? saveProfile() : startEditProfile()" 
                    class="px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                    [class]="isEditingProfile ? 'bg-green-600 text-white' : 'bg-blue-600 text-white'">
              {{ isEditingProfile ? 'Simpan' : 'Edit' }}
            </button>
          </div>
  
          <div class="space-y-4">
            <!-- Name -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap</label>
              <input *ngIf="isEditingProfile" 
                     [(ngModel)]="tempProfile.name"
                     type="text" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              <p *ngIf="!isEditingProfile" class="text-gray-800 py-2">{{ userProfile.name }}</p>
            </div>
  
            <!-- Email -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
              <input *ngIf="isEditingProfile" 
                     [(ngModel)]="tempProfile.email"
                     type="email" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              <p *ngIf="!isEditingProfile" class="text-gray-800 py-2">{{ userProfile.email }}</p>
            </div>
  
            <!-- Phone -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Nomor Telepon</label>
              <input *ngIf="isEditingProfile" 
                     [(ngModel)]="tempProfile.phone"
                     type="tel" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              <p *ngIf="!isEditingProfile" class="text-gray-800 py-2">{{ userProfile.phone }}</p>
            </div>
  
            <!-- Location -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Alamat</label>
              <textarea *ngIf="isEditingProfile" 
                        [(ngModel)]="tempProfile.location!.address"
                        rows="2" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"></textarea>
              <p *ngIf="!isEditingProfile" class="text-gray-800 py-2">
                {{ userProfile.location.address }}, {{ userProfile.location.city }}, {{ userProfile.location.province }}
              </p>
            </div>
  
            <div *ngIf="isEditingProfile" class="flex gap-3">
              <button (click)="cancelEditProfile()" 
                      class="flex-1 bg-gray-100 text-gray-600 py-2 rounded-lg font-medium hover:bg-gray-200 transition-colors">
                Batal
              </button>
              <button (click)="saveProfile()" 
                      class="flex-1 bg-green-600 text-white py-2 rounded-lg font-medium hover:bg-green-700 transition-colors">
                Simpan
              </button>
            </div>
          </div>
        </div>
  
        <!-- Specializations -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Spesialisasi Layanan</h3>
          <div class="grid grid-cols-2 gap-3">
            <div *ngFor="let spec of specializationOptions" 
                 (click)="toggleSpecialization(spec.value)"
                 class="flex items-center gap-3 p-3 border rounded-lg cursor-pointer transition-colors"
                 [class]="isSpecializationSelected(spec.value) ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'">
              <ion-icon [name]="spec.icon" class="text-gray-600"></ion-icon>
              <span class="text-sm font-medium text-gray-800">{{ spec.label }}</span>
              <ion-icon *ngIf="isSpecializationSelected(spec.value)" 
                        name="checkmark-circle" 
                        class="text-blue-600 ml-auto"></ion-icon>
            </div>
          </div>
        </div>
  
        <!-- Working Hours -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Jam Kerja</h3>
          
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Jam Mulai</label>
              <input [(ngModel)]="userProfile.workingHours.start" 
                     type="time" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Jam Selesai</label>
              <input [(ngModel)]="userProfile.workingHours.end" 
                     type="time" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
          </div>
  
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Hari Kerja</label>
            <div class="grid grid-cols-4 gap-2">
              <button *ngFor="let dayOption of workingDaysOptions"
                      (click)="toggleWorkingDay(dayOption.value)"
                      class="p-2 text-xs rounded-lg font-medium transition-colors"
                      [class]="isWorkingDaySelected(dayOption.value) ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'">
                {{ dayOption.label }}
              </button>
            </div>
            <p class="text-xs text-gray-500 mt-2">
              Hari aktif: {{ getWorkingDaysLabel() }}
            </p>
          </div>
        </div>
  
        <!-- Account Actions -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Akun</h3>
          <div class="space-y-3">
            <button (click)="changePassword()" 
                    class="w-full flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors">
              <div class="flex items-center gap-3">
                <ion-icon name="key" class="text-gray-600"></ion-icon>
                <span class="text-gray-800">Ubah Password</span>
              </div>
              <ion-icon name="chevron-forward" class="text-gray-400"></ion-icon>
            </button>
  
            <button (click)="exportData()" 
                    class="w-full flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors">
              <div class="flex items-center gap-3">
                <ion-icon name="download" class="text-gray-600"></ion-icon>
                <span class="text-gray-800">Ekspor Data</span>
              </div>
              <ion-icon name="chevron-forward" class="text-gray-400"></ion-icon>
            </button>
  
            <button (click)="deleteAccount()" 
                    class="w-full flex items-center justify-between p-3 hover:bg-red-50 rounded-lg transition-colors">
              <div class="flex items-center gap-3">
                <ion-icon name="trash" class="text-red-600"></ion-icon>
                <span class="text-red-600">Hapus Akun</span>
              </div>
              <ion-icon name="chevron-forward" class="text-red-400"></ion-icon>
            </button>
          </div>
        </div>
      </div>
  
      <!-- Notifications Section -->
      <div *ngIf="currentSection === 'notifications'" class="space-y-4 fade-in">
        
        <!-- Push Notifications -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Notifikasi Push</h3>
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-gray-800">Order Baru</p>
                <p class="text-sm text-gray-500">Notifikasi saat ada order masuk</p>
              </div>
              <div class="toggle-switch" 
                   [class.active]="notificationSettings.newOrders"
                   (click)="toggleNotification('newOrders')">
                <div class="toggle-slider"></div>
              </div>
            </div>
  
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-gray-800">Update Order</p>
                <p class="text-sm text-gray-500">Notifikasi perubahan status order</p>
              </div>
              <div class="toggle-switch" 
                   [class.active]="notificationSettings.orderUpdates"
                   (click)="toggleNotification('orderUpdates')">
                <div class="toggle-slider"></div>
              </div>
            </div>
  
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-gray-800">Pembayaran</p>
                <p class="text-sm text-gray-500">Notifikasi saat pembayaran masuk</p>
              </div>
              <div class="toggle-switch" 
                   [class.active]="notificationSettings.payments"
                   (click)="toggleNotification('payments')">
                <div class="toggle-slider"></div>
              </div>
            </div>
  
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-gray-800">Promosi</p>
                <p class="text-sm text-gray-500">Notifikasi promo dan penawaran</p>
              </div>
              <div class="toggle-switch" 
                   [class.active]="notificationSettings.promotions"
                   (click)="toggleNotification('promotions')">
                <div class="toggle-slider"></div>
              </div>
            </div>
  
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-gray-800">Update Sistem</p>
                <p class="text-sm text-gray-500">Notifikasi update aplikasi</p>
              </div>
              <div class="toggle-switch" 
                   [class.active]="notificationSettings.systemUpdates"
                   (click)="toggleNotification('systemUpdates')">
                <div class="toggle-slider"></div>
              </div>
            </div>
          </div>
        </div>
  
        <!-- Sound & Vibration -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Suara & Getaran</h3>
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <ion-icon name="volume-high" class="text-gray-600"></ion-icon>
                <span class="font-medium text-gray-800">Suara Notifikasi</span>
              </div>
              <div class="toggle-switch" 
                   [class.active]="notificationSettings.sound"
                   (click)="toggleNotification('sound')">
                <div class="toggle-slider"></div>
              </div>
            </div>
  
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <ion-icon name="phone-portrait" class="text-gray-600"></ion-icon>
                <span class="font-medium text-gray-800">Getaran</span>
              </div>
              <div class="toggle-switch" 
                   [class.active]="notificationSettings.vibration"
                   (click)="toggleNotification('vibration')">
                <div class="toggle-slider"></div>
              </div>
            </div>
          </div>
        </div>
  
        <!-- Communication -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Komunikasi</h3>
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <ion-icon name="mail" class="text-gray-600"></ion-icon>
                <span class="font-medium text-gray-800">Email Notifikasi</span>
              </div>
              <div class="toggle-switch" 
                   [class.active]="notificationSettings.emailNotifications"
                   (click)="toggleNotification('emailNotifications')">
                <div class="toggle-slider"></div>
              </div>
            </div>
  
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <ion-icon name="chatbubble" class="text-gray-600"></ion-icon>
                <span class="font-medium text-gray-800">SMS Notifikasi</span>
              </div>
              <div class="toggle-switch" 
                   [class.active]="notificationSettings.smsNotifications"
                   (click)="toggleNotification('smsNotifications')">
                <div class="toggle-slider"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
  
      <!-- Security Section -->
      <div *ngIf="currentSection === 'security'" class="space-y-4 fade-in">
        
        <!-- Authentication -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Autentikasi</h3>
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-gray-800">Login Biometrik</p>
                <p class="text-sm text-gray-500">Sidik jari atau Face ID</p>
              </div>
              <div class="toggle-switch" 
                   [class.active]="securitySettings.biometricLogin"
                   (click)="toggleSecurity('biometricLogin')">
                <div class="toggle-slider"></div>
              </div>
            </div>
  
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-gray-800">Login dengan PIN</p>
                <p class="text-sm text-gray-500">Gunakan PIN 6 digit</p>
              </div>
              <div class="toggle-switch" 
                   [class.active]="securitySettings.pinLogin"
                   (click)="toggleSecurity('pinLogin')">
                <div class="toggle-slider"></div>
              </div>
            </div>
  
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-gray-800">Autentikasi Dua Faktor</p>
                <p class="text-sm text-gray-500">Keamanan tambahan dengan SMS</p>
              </div>
              <div class="toggle-switch" 
                   [class.active]="securitySettings.twoFactorAuth"
                   (click)="toggleSecurity('twoFactorAuth')">
                <div class="toggle-slider"></div>
              </div>
            </div>
          </div>
        </div>
  
        <!-- Session Management -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Manajemen Sesi</h3>
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-gray-800">Auto Logout</p>
                <p class="text-sm text-gray-500">Logout otomatis saat tidak aktif</p>
              </div>
              <div class="toggle-switch" 
                   [class.active]="securitySettings.autoLogout"
                   (click)="toggleSecurity('autoLogout')">
                <div class="toggle-slider"></div>
              </div>
            </div>
  
            <div *ngIf="securitySettings.autoLogout" class="ml-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">Waktu Auto Logout</label>
              <select [(ngModel)]="securitySettings.autoLogoutTime" 
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="5">5 menit</option>
                <option value="15">15 menit</option>
                <option value="30">30 menit</option>
                <option value="60">1 jam</option>
              </select>
            </div>
  
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-gray-800">Alert Login</p>
                <p class="text-sm text-gray-500">Notifikasi saat ada login baru</p>
              </div>
              <div class="toggle-switch" 
                   [class.active]="securitySettings.loginAlerts"
                   (click)="toggleSecurity('loginAlerts')">
                <div class="toggle-slider"></div>
              </div>
            </div>
          </div>
        </div>
  
        <!-- Privacy -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Privasi</h3>
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-gray-800">Sembunyikan Saldo</p>
                <p class="text-sm text-gray-500">Saldo tersembunyi secara default</p>
              </div>
              <div class="toggle-switch" 
                   [class.active]="securitySettings.hideBalance"
                   (click)="toggleSecurity('hideBalance')">
                <div class="toggle-slider"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
  
      <!-- Preferences Section -->
      <div *ngIf="currentSection === 'preferences'" class="space-y-4 fade-in">
        
        <!-- Display -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Tampilan</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Tema Aplikasi</label>
              <div class="grid grid-cols-3 gap-2">
                <button *ngFor="let theme of themeOptions"
                        (click)="updatePreference('theme', theme.value)"
                        class="flex flex-col items-center gap-2 p-3 border rounded-lg transition-colors"
                        [class]="appPreferences.theme === theme.value ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'">
                  <ion-icon [name]="theme.icon" class="text-xl"></ion-icon>
                  <span class="text-xs font-medium">{{ theme.label }}</span>
                </button>
              </div>
            </div>
  
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Bahasa</label>
              <div class="grid grid-cols-2 gap-2">
                <button *ngFor="let lang of languageOptions"
                        (click)="updatePreference('language', lang.value)"
                        class="flex items-center gap-3 p-3 border rounded-lg transition-colors"
                        [class]="appPreferences.language === lang.value ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'">
                  <span class="text-xl">{{ lang.flag }}</span>
                  <span class="text-sm font-medium">{{ lang.label }}</span>
                </button>
              </div>
            </div>
  
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-gray-800">Haptic Feedback</p>
                <p class="text-sm text-gray-500">Getaran saat sentuh tombol</p>
              </div>
              <div class="toggle-switch" 
                   [class.active]="appPreferences.hapticFeedback"
                   (click)="updatePreference('hapticFeedback', !appPreferences.hapticFeedback)">
                <div class="toggle-slider"></div>
              </div>
            </div>
  
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-gray-800">Tampilkan Tips</p>
                <p class="text-sm text-gray-500">Tips dan panduan dalam aplikasi</p>
              </div>
              <div class="toggle-switch" 
                   [class.active]="appPreferences.showTips"
                   (click)="updatePreference('showTips', !appPreferences.showTips)">
                <div class="toggle-slider"></div>
              </div>
            </div>
          </div>
        </div>
  
        <!-- Format -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Format</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Format Tanggal</label>
              <select [(ngModel)]="appPreferences.dateFormat" 
                      (ngModelChange)="updatePreference('dateFormat', appPreferences.dateFormat)"
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="DD/MM/YYYY">DD/MM/YYYY (25/07/2024)</option>
                <option value="MM/DD/YYYY">MM/DD/YYYY (07/25/2024)</option>
                <option value="YYYY-MM-DD">YYYY-MM-DD (2024-07-25)</option>
              </select>
            </div>
  
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Format Waktu</label>
              <select [(ngModel)]="appPreferences.timeFormat" 
                      (ngModelChange)="updatePreference('timeFormat', appPreferences.timeFormat)"
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="12h">12 Jam (2:30 PM)</option>
                <option value="24h">24 Jam (14:30)</option>
              </select>
            </div>
  
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Satuan Jarak</label>
              <select [(ngModel)]="appPreferences.distanceUnit" 
                      (ngModelChange)="updatePreference('distanceUnit', appPreferences.distanceUnit)"
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="km">Kilometer (km)</option>
                <option value="mile">Mile</option>
              </select>
            </div>
          </div>
        </div>
  
        <!-- Maps & Location -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Peta & Lokasi</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Provider Peta</label>
              <div class="grid grid-cols-2 gap-2">
                <button *ngFor="let provider of mapProviderOptions"
                        (click)="updatePreference('mapProvider', provider.value)"
                        class="flex items-center gap-3 p-3 border rounded-lg transition-colors"
                        [class]="appPreferences.mapProvider === provider.value ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'">
                  <ion-icon [name]="provider.icon" class="text-xl"></ion-icon>
                  <span class="text-sm font-medium">{{ provider.label }}</span>
                </button>
              </div>
            </div>
  
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Radius Auto Accept ({{ appPreferences.autoAcceptRadius }} km)
              </label>
              <input [(ngModel)]="appPreferences.autoAcceptRadius" 
                     (ngModelChange)="updatePreference('autoAcceptRadius', appPreferences.autoAcceptRadius)"
                     type="range" 
                     min="1" 
                     max="20" 
                     class="w-full">
              <div class="flex justify-between text-xs text-gray-500 mt-1">
                <span>1 km</span>
                <span>20 km</span>
              </div>
            </div>
          </div>
        </div>
  
        <!-- Data & Storage -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Data & Storage</h3>
          <div class="space-y-3">
            <button (click)="clearCache()" 
                    class="w-full flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors">
              <div class="flex items-center gap-3">
                <ion-icon name="refresh" class="text-gray-600"></ion-icon>
                <span class="text-gray-800">Bersihkan Cache</span>
              </div>
              <ion-icon name="chevron-forward" class="text-gray-400"></ion-icon>
            </button>
          </div>
        </div>
      </div>
  
      <!-- Business Section -->
      <div *ngIf="currentSection === 'business'" class="space-y-4 fade-in">
        
        <!-- Business Info -->
        <div class="setting-card p-4">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-bold text-gray-800">Informasi Bisnis</h3>
            <button (click)="isEditingBusiness ? saveBusiness() : startEditBusiness()" 
                    class="px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                    [class]="isEditingBusiness ? 'bg-green-600 text-white' : 'bg-blue-600 text-white'">
              {{ isEditingBusiness ? 'Simpan' : 'Edit' }}
            </button>
          </div>
  
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Nama Bisnis</label>
              <input *ngIf="isEditingBusiness" 
                     [(ngModel)]="tempBusiness.businessName"
                     type="text" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              <p *ngIf="!isEditingBusiness" class="text-gray-800 py-2">{{ businessInfo.businessName }}</p>
            </div>
  
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Jenis Bisnis</label>
              <select *ngIf="isEditingBusiness" 
                      [(ngModel)]="tempBusiness.businessType"
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option *ngFor="let type of businessTypeOptions" [value]="type.value">
                  {{ type.label }}
                </option>
              </select>
              <p *ngIf="!isEditingBusiness" class="text-gray-800 py-2">{{ businessInfo.businessType }}</p>
            </div>
  
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Nomor Izin (NIB)</label>
              <input *ngIf="isEditingBusiness" 
                     [(ngModel)]="tempBusiness.licenseNumber"
                     type="text" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              <p *ngIf="!isEditingBusiness" class="text-gray-800 py-2">{{ businessInfo.licenseNumber }}</p>
            </div>
  
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">NPWP</label>
              <input *ngIf="isEditingBusiness" 
                     [(ngModel)]="tempBusiness.taxId"
                     type="text" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
              <p *ngIf="!isEditingBusiness" class="text-gray-800 py-2">{{ businessInfo.taxId }}</p>
            </div>
  
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Alamat Bisnis</label>
              <textarea *ngIf="isEditingBusiness" 
                        [(ngModel)]="tempBusiness.businessAddress"
                        rows="2" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"></textarea>
              <p *ngIf="!isEditingBusiness" class="text-gray-800 py-2">{{ businessInfo.businessAddress }}</p>
            </div>
  
            <div *ngIf="isEditingBusiness" class="flex gap-3">
              <button (click)="cancelEditBusiness()" 
                      class="flex-1 bg-gray-100 text-gray-600 py-2 rounded-lg font-medium hover:bg-gray-200 transition-colors">
                Batal
              </button>
              <button (click)="saveBusiness()" 
                      class="flex-1 bg-green-600 text-white py-2 rounded-lg font-medium hover:bg-green-700 transition-colors">
                Simpan
              </button>
            </div>
          </div>
        </div>
  
        <!-- Bank Account -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Rekening Bank</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Nama Bank</label>
              <p class="text-gray-800 py-2">{{ businessInfo.bankAccount.bankName }}</p>
            </div>
  
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Nomor Rekening</label>
              <p class="text-gray-800 py-2">{{ businessInfo.bankAccount.accountNumber }}</p>
            </div>
  
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Nama Pemegang Rekening</label>
              <p class="text-gray-800 py-2">{{ businessInfo.bankAccount.accountHolder }}</p>
            </div>
  
            <button class="w-full bg-blue-100 text-blue-600 py-3 rounded-lg font-medium hover:bg-blue-200 transition-colors">
              Ubah Rekening Bank
            </button>
          </div>
        </div>
  
        <!-- Emergency Contact -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Kontak Darurat</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Nama</label>
              <p class="text-gray-800 py-2">{{ businessInfo.emergencyContact.name }}</p>
            </div>
  
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Nomor Telepon</label>
              <p class="text-gray-800 py-2">{{ businessInfo.emergencyContact.phone }}</p>
            </div>
  
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Hubungan</label>
              <p class="text-gray-800 py-2">{{ businessInfo.emergencyContact.relationship }}</p>
            </div>
  
            <button class="w-full bg-blue-100 text-blue-600 py-3 rounded-lg font-medium hover:bg-blue-200 transition-colors">
              Ubah Kontak Darurat
            </button>
          </div>
        </div>
      </div>
  
      <!-- Help Section -->
      <div *ngIf="currentSection === 'help'" class="space-y-4 fade-in">
        
        <!-- Support -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Dukungan</h3>
          <div class="space-y-3">
            <button (click)="contactSupport()" 
                    class="w-full flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors">
              <div class="flex items-center gap-3">
                <ion-icon name="chatbubble" class="text-gray-600"></ion-icon>
                <div class="text-left">
                  <p class="text-gray-800">Customer Support</p>
                  <p class="text-sm text-gray-500">Chat dengan tim support</p>
                </div>
              </div>
              <ion-icon name="chevron-forward" class="text-gray-400"></ion-icon>
            </button>
  
            <button (click)="showModalContent('FAQ', 'Frequently Asked Questions content here...')" 
                    class="w-full flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors">
              <div class="flex items-center gap-3">
                <ion-icon name="help" class="text-gray-600"></ion-icon>
                <div class="text-left">
                  <p class="text-gray-800">FAQ</p>
                  <p class="text-sm text-gray-500">Pertanyaan yang sering diajukan</p>
                </div>
              </div>
              <ion-icon name="chevron-forward" class="text-gray-400"></ion-icon>
            </button>
  
            <button (click)="showModalContent('Panduan Pengguna', 'User guide content here...')" 
                    class="w-full flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors">
              <div class="flex items-center gap-3">
                <ion-icon name="document" class="text-gray-600"></ion-icon>
                <div class="text-left">
                  <p class="text-gray-800">Panduan Pengguna</p>
                  <p class="text-sm text-gray-500">Tutorial lengkap aplikasi</p>
                </div>
              </div>
              <ion-icon name="chevron-forward" class="text-gray-400"></ion-icon>
            </button>
  
            <button (click)="reportBug()" 
                    class="w-full flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors">
              <div class="flex items-center gap-3">
                <ion-icon name="bug" class="text-gray-600"></ion-icon>
                <div class="text-left">
                  <p class="text-gray-800">Laporkan Bug</p>
                  <p class="text-sm text-gray-500">Laporkan masalah aplikasi</p>
                </div>
              </div>
              <ion-icon name="chevron-forward" class="text-gray-400"></ion-icon>
            </button>
          </div>
        </div>
  
        <!-- Legal -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Legal</h3>
          <div class="space-y-3">
            <button (click)="showModalContent('Syarat & Ketentuan', 'Terms and conditions content here...')" 
                    class="w-full flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors">
              <div class="flex items-center gap-3">
                <ion-icon name="document" class="text-gray-600"></ion-icon>
                <span class="text-gray-800">Syarat & Ketentuan</span>
              </div>
              <ion-icon name="chevron-forward" class="text-gray-400"></ion-icon>
            </button>
  
            <button (click)="showModalContent('Kebijakan Privasi', 'Privacy policy content here...')" 
                    class="w-full flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors">
              <div class="flex items-center gap-3">
                <ion-icon name="shield" class="text-gray-600"></ion-icon>
                <span class="text-gray-800">Kebijakan Privasi</span>
              </div>
              <ion-icon name="chevron-forward" class="text-gray-400"></ion-icon>
            </button>
  
            <button (click)="showModalContent('Lisensi', 'License information content here...')" 
                    class="w-full flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors">
              <div class="flex items-center gap-3">
                <ion-icon name="key" class="text-gray-600"></ion-icon>
                <span class="text-gray-800">Lisensi</span>
              </div>
              <ion-icon name="chevron-forward" class="text-gray-400"></ion-icon>
            </button>
          </div>
        </div>
  
        <!-- Community -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Komunitas</h3>
          <div class="space-y-3">
            <button (click)="shareApp()" 
                    class="w-full flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors">
              <div class="flex items-center gap-3">
                <ion-icon name="share" class="text-gray-600"></ion-icon>
                <div class="text-left">
                  <p class="text-gray-800">Bagikan Aplikasi</p>
                  <p class="text-sm text-gray-500">Ajak teman untuk bergabung</p>
                </div>
              </div>
              <ion-icon name="chevron-forward" class="text-gray-400"></ion-icon>
            </button>
  
            <button (click)="rateApp()" 
                    class="w-full flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors">
              <div class="flex items-center gap-3">
                <ion-icon name="star" class="text-gray-600"></ion-icon>
                <div class="text-left">
                  <p class="text-gray-800">Beri Rating</p>
                  <p class="text-sm text-gray-500">Rating di Play Store</p>
                </div>
              </div>
              <ion-icon name="chevron-forward" class="text-gray-400"></ion-icon>
            </button>
  
            <button class="w-full flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg transition-colors">
              <div class="flex items-center gap-3">
                <ion-icon name="heart" class="text-gray-600"></ion-icon>
                <div class="text-left">
                  <p class="text-gray-800">Feedback</p>
                  <p class="text-sm text-gray-500">Berikan saran dan masukan</p>
                </div>
              </div>
              <ion-icon name="chevron-forward" class="text-gray-400"></ion-icon>
            </button>
          </div>
        </div>
  
        <!-- App Info -->
        <div class="setting-card p-4">
          <h3 class="font-bold text-gray-800 mb-4">Informasi Aplikasi</h3>
          <div class="space-y-3">
            <div class="flex justify-between py-2">
              <span class="text-gray-600">Versi Aplikasi</span>
              <span class="text-gray-800">2.1.0</span>
            </div>
            
            <div class="flex justify-between py-2">
              <span class="text-gray-600">Build Number</span>
              <span class="text-gray-800">210724</span>
            </div>
            
            <div class="flex justify-between py-2">
              <span class="text-gray-600">Terakhir Update</span>
              <span class="text-gray-800">25 Juli 2024</span>
            </div>
  
            <button (click)="showModalContent('Changelog', 'Version 2.1.0 changelog...')" 
                    class="w-full bg-blue-100 text-blue-600 py-3 rounded-lg font-medium hover:bg-blue-200 transition-colors">
              Lihat Changelog
            </button>
          </div>
        </div>
      </div>
  
      <!-- Logout Button -->
      <div class="setting-card p-4 fade-in">
        <button (click)="logout()" 
                class="w-full flex items-center justify-center gap-3 p-4 bg-red-50 hover:bg-red-100 rounded-lg transition-colors">
          <ion-icon name="log-out" class="text-red-600 text-xl"></ion-icon>
          <span class="text-red-600 font-semibold">Logout</span>
        </button>
      </div>
  
      <!-- App Version Footer -->
      <div class="text-center py-4">
        <p class="text-xs text-gray-400">
          MitraTech v2.1.0 • Build 210724
        </p>
        <p class="text-xs text-gray-400 mt-1">
          © 2024 MitraTech. All rights reserved.
        </p>
      </div>
  
    </div>
  
    <!-- Modal -->
    <div *ngIf="showModal" 
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
         (click)="closeModal()">
      <div class="bg-white rounded-xl w-full max-w-md max-h-[80vh] overflow-hidden slide-up" 
           (click)="$event.stopPropagation()">
        
        <div class="p-4 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-bold text-gray-800">{{ modalTitle }}</h3>
            <button (click)="closeModal()">
              <ion-icon name="close" class="text-2xl text-gray-400"></ion-icon>
            </button>
          </div>
        </div>
  
        <div class="p-4 overflow-y-auto max-h-96">
          <div *ngIf="modalTitle === 'FAQ'" class="space-y-4">
            <div class="border-b border-gray-200 pb-4">
              <h4 class="font-semibold text-gray-800 mb-2">Bagaimana cara menerima order?</h4>
              <p class="text-sm text-gray-600">Aktifkan status online di dashboard, kemudian order akan otomatis masuk ke aplikasi Anda.</p>
            </div>
            <div class="border-b border-gray-200 pb-4">
              <h4 class="font-semibold text-gray-800 mb-2">Kapan saya bisa menarik saldo?</h4>
              <p class="text-sm text-gray-600">Saldo dapat ditarik setiap saat dengan minimum Rp 10.000 untuk e-wallet dan Rp 50.000 untuk bank transfer.</p>
            </div>
            <div class="border-b border-gray-200 pb-4">
              <h4 class="font-semibold text-gray-800 mb-2">Bagaimana sistem rating bekerja?</h4>
              <p class="text-sm text-gray-600">Customer akan memberikan rating 1-5 bintang setelah service selesai. Rating Anda mempengaruhi prioritas mendapat order.</p>
            </div>
            <div class="pb-4">
              <h4 class="font-semibold text-gray-800 mb-2">Apa yang harus dilakukan jika ada masalah?</h4>
              <p class="text-sm text-gray-600">Hubungi customer support melalui menu bantuan atau chat langsung dengan customer jika ada kendala dalam order.</p>
            </div>
          </div>
  
          <div *ngIf="modalTitle === 'Panduan Pengguna'" class="space-y-4">
            <h4 class="font-semibold text-gray-800">Langkah Memulai:</h4>
            <ol class="list-decimal list-inside space-y-2 text-sm text-gray-600">
              <li>Lengkapi profil dan verifikasi dokumen</li>
              <li>Atur spesialisasi dan jam kerja</li>
              <li>Aktifkan status online di dashboard</li>
              <li>Tunggu order masuk dan terima dengan cepat</li>
              <li>Berikan service terbaik untuk rating tinggi</li>
            </ol>
            
            <h4 class="font-semibold text-gray-800 mt-6">Tips Sukses:</h4>
            <ul class="list-disc list-inside space-y-2 text-sm text-gray-600">
              <li>Selalu online di jam-jam sibuk (07:00-09:00, 17:00-19:00)</li>
              <li>Respons order dalam 3 menit untuk prioritas tinggi</li>
              <li>Dokumentasikan pekerjaan dengan foto</li>
              <li>Komunikasi yang baik dengan customer</li>
              <li>Jaga rating di atas 4.5 bintang</li>
            </ul>
          </div>
  
          <div *ngIf="modalTitle === 'Syarat & Ketentuan'" class="text-sm text-gray-600 space-y-3">
            <p><strong>1. Persyaratan Mitra</strong></p>
            <p>Mitra harus memiliki keahlian dan sertifikat yang relevan, berusia minimal 18 tahun, dan memiliki dokumen identitas yang valid.</p>
            
            <p><strong>2. Kewajiban Mitra</strong></p>
            <p>Memberikan service berkualitas, menghormati customer, menjaga rahasia informasi customer, dan melaporkan masalah dengan segera.</p>
            
            <p><strong>3. Pembayaran dan Komisi</strong></p>
            <p>Platform akan memotong komisi 10-15% dari setiap transaksi. Pembayaran akan diproses sesuai metode yang dipilih.</p>
          </div>
  
          <div *ngIf="modalTitle === 'Kebijakan Privasi'" class="text-sm text-gray-600 space-y-3">
            <p><strong>Pengumpulan Data</strong></p>
            <p>Kami mengumpulkan data pribadi, lokasi, dan aktivitas untuk memberikan layanan terbaik.</p>
            
            <p><strong>Penggunaan Data</strong></p>
            <p>Data digunakan untuk matching order, pembayaran, peningkatan layanan, dan keamanan platform.</p>
            
            <p><strong>Keamanan Data</strong></p>
            <p>Data dilindungi dengan enkripsi dan sistem keamanan tingkat tinggi sesuai standar industri.</p>
          </div>
  
          <div *ngIf="modalTitle === 'Changelog'" class="text-sm text-gray-600 space-y-3">
            <p><strong>Version 2.1.0 (25 Juli 2024)</strong></p>
            <ul class="list-disc list-inside space-y-1">
              <li>✨ Fitur auto-accept order dalam radius tertentu</li>
              <li>🔧 Perbaikan stabilitas aplikasi</li>
              <li>💰 Update tampilan halaman saldo</li>
              <li>📊 Dashboard statistik yang lebih detail</li>
              <li>🔔 Pengaturan notifikasi yang lebih fleksibel</li>
            </ul>
            
            <p class="mt-4"><strong>Version 2.0.5 (10 Juli 2024)</strong></p>
            <ul class="list-disc list-inside space-y-1">
              <li>🐛 Perbaikan bug pada filter riwayat order</li>
              <li>⚡ Peningkatan performa loading data</li>
              <li>🎨 Update UI untuk pengalaman yang lebih baik</li>
            </ul>
          </div>
        </div>
  
        <div class="p-4 border-t border-gray-200">
          <button (click)="closeModal()" 
                  class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors">
            Tutup
          </button>
        </div>
      </div>
    </div>
  </div>

</ion-content>

<!-- Toast -->
<ion-toast 
  [isOpen]="showToast"
  [message]="toastMessage"
  [duration]="3000"
  [position]="'bottom'"
  (didDismiss)="showToast = false">
</ion-toast>